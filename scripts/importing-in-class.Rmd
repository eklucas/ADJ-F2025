---
title: "Importing"
output:
  html_document:
    df_print: paged
---

As a reminder, always add your packages at the top of your script. We'll use the `readxl` package to import an .xlsx file, and `googlesheets4` to import directly from a gooogle sheet.

```{r setup, message = F}
library(tidyverse)
library(readxl)
library(googlesheets4)
```

### Importing flat text files

Before we import data, let's explore the options associated with `read_csv()` by looking at the docs.

```{r}
?read_csv
```

Note that there are a group of functions that show up, including read_tsv and read_delim. These are functions you can use for files with different formatting: tsv imports a tab-delimited file, and read_delim allows you to specify another delimiter.

You can also include optional arguments to:

-   specify column names (if your file doesn't have them) `col_names = c("name1", "name2", "name3")`
-   specify data types for each column `col_types = "nnnnnccccc"` (five numeric columns followed by five character columns)
-   import everything as character `col_types = cols(.default = "c")`
-   skip rows if your file has extra header rows `skip = 2`

To illustrate some of these options, we'll use a file we're familiar with: `nps_annual.csv`, national park visit data:

```{r}
data <- read_csv("data/nps_annual.csv")
glimpse(data)
```

Note that this file has a header row, and it's fairly clean. But for the sake of exploring different importing options, we'll ignore it for the moment.

If we use the `col_names` argument to say that this file does not have a header row, it will regard the first row as a row of data:

```{r}
data <- read_csv("data/nps_annual.csv", col_names=FALSE)
glimpse(data)
```

If we use `col_names` to specify a new set of column names, it will also assume the file does not have a header row:

```{r}
data <- read_csv("data/nps_annual.csv", col_names=c("Park","Region","state","year","visits"))
glimpse(data)
```

If it does have a header row but you just want to throw it out and create your own, use the `skip = 1` argument:

```{r}
data <- read_csv("data/nps_annual.csv", col_names=c("Park","Region","state","year","visits"), skip = 1)
glimpse(data)
```

Let's talk data types. You can use `col_types` to specify one type for each column. See the documentation for the different data types:

-   c = character
-   i = integer
-   n = number
-   d = double
-   l = logical
-   f = factor
-   D = date
-   T = date time
-   t = time
-   ? = guess
-   \_ or - = skip

For this file, let's say I want to enforce four character columns and one number column, in that order:
```{r}
data <- read_csv("data/nps_annual.csv", col_types="ccccn")
glimpse(data)
```

Alternately, I could import everything as character. Sometimes this is the easiest way to import really dirty data, and then you can clean things up and convert columns to dates and numbers as you see fit: 
```{r}
data <- read_csv("data/nps_annual.csv", col_types = cols(.default = "c"))
glimpse(data)
```

To change just one column type, enter `?` for the rest of the columns (this tells R to guess, which it's good at):
```{r}
data <- read_csv("data/nps_annual.csv", col_types = "???c?")
glimpse(data)
```

Or use `cols` if you don't want to type a bunch of question marks:
```{r}
data <- read_csv("data/nps_annual.csv", col_types = cols(`Year` = "c"))
glimpse(data)
```


### Importing excel files

This is relatively straightforward, and primarily we use the function `read_excel()` to import .xlsx or .xls files. This function has very similar arguments to `read_csv()`, and you can use the col_names and col_types arguments in the same way. With `read_excel()`, you can also specify what sheet in an excel workbook you want to import. 
```{r}
?read_excel
```

In our example, `cpi-u-historical.xlsx`, the first sheet is the data and the second is a notes tab, so be default it will just import the first sheet. If you wanted to, you could specify the sheet explicitly: 

```{r}
cpi <- read_excel("data/cpi-u-historical.xlsx", sheet=1)
```

`read_excel` also allows you to import a particular range. This is especially helpful if your excel file has a bunch of unnecessary headers or notes at the top (which happens often):

```{r}
cpi <- read_excel("data/cpi-u-historical.xlsx", range = "A12:O125")
```

### Importing from a google sheet

The `googlesheets4` package lets you read from (and write to) google sheets. You will need to authenticate your google account, granting tidyverse access to the files in your drive (this authentication process will start below in the console).  

```{r}
?read_sheet
```

To import from a google sheet you need the ss id, or the long string of letters and numbers that appears in the URL between *https://docs.google.com/spreadsheets/d/* and */edit?gid=0*. With this function you can also use a lot of the same arguments as `read_csv()` and `read_excel()`:

```{r}
read_sheet("14riMfTuuy8s1Uk6FEEVUXQicgeQOKve5ipEDOY_m1KI")
```

Note that you can import many different types of files to R, using several different packages. These are just the most commonly used by journalists. You just have to find the right function and the right package for what you need. Check out the `foreign` package, for example, which is great at helping you import large survey files of various types. 